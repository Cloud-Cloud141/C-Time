<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Zeit - Smooth & Locked</title>
    <link rel="icon" href="CLOUD.png" type="image/png">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a5f3f 0%, #c41e3a 100%);
            font-family: 'Poppins', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            overflow: hidden;
        }
        .clock-container { display: flex; flex-direction: column; align-items: center; gap: 2rem; }
        #digitalTime { font-size: 3.5rem; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.1em; }
        #analogClock {
            width: 400px; height: 400px;
            border: 8px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            background: rgba(0,0,0,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3), inset 0 0 20px rgba(0,0,0,0.2);
        }
        .version { position: fixed; bottom: 20px; right: 20px; font-size: 0.75rem; color: rgba(255,255,255,0.6); }
        
        /* Overlay Styles */
        .clockOverlay { 
            position:fixed; left:0; top:0; right:0; bottom:0; 
            background:#000; z-index:9999; visibility:hidden; 
            opacity:0; transition:opacity 240ms ease, visibility 240ms; 
            display:flex; align-items:center; justify-content:center; flex-direction:column; 
        }
        .clockOverlay.visible { visibility:visible; opacity:1; }
        .digitalOnly { font-size:5rem; font-weight:700; color:#fff; font-family: 'Poppins', sans-serif; }
        canvas.analogCanvas { display:block; max-width:400px; width:90vw; height:auto; }
        .close-hint { color:#fff; opacity:0.7; margin-top:1.5rem; font-size:0.95rem; }

        /* Schnee */
        .snowflake { position:fixed; color:#fff; font-size:1.5em; z-index:9998; user-select:none; pointer-events:none; }
        @keyframes fall { to { transform:translateY(100vh) rotate(360deg); } }
    </style>
</head>
<body>

    <div class="clock-container" onclick="enterFullscreen()">
        <div id="digitalTime">00:00</div>
        <canvas id="analogClock" width="400" height="400"></canvas>
    </div>

    <div class="version">v2.3</div>

    <script>
        // --- GLOBALE STEUERUNG ---
        let exitAllowed = false;

        const isTyping = () => {
            const active = document.activeElement;
            return active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA' || active.isContentEditable);
        };

        async function enterFullscreen() {
            try {
                if (!document.fullscreenElement) {
                    await document.documentElement.requestFullscreen();
                }
            } catch (e) {}
        }

        async function leaveFullscreen() {
            try {
                if (document.fullscreenElement) await document.exitFullscreen();
            } catch (e) {}
        }

        // Tasten-Logik
        document.addEventListener('keydown', (ev) => {
            const key = ev.key.toLowerCase();
            
            // BEENDEN NUR ÜBER 'B'
            if (key === 'b' && !isTyping()) {
                if (!document.fullscreenElement) {
                    exitAllowed = false;
                    enterFullscreen();
                } else {
                    exitAllowed = true;
                    leaveFullscreen();
                }
            }

            // ESCAPE BLOCKIEREN / ÜBERSTEUERN
            if (ev.key === 'Escape') {
                if (!exitAllowed) {
                    ev.preventDefault();
                    // Kurze Verzögerung, damit der Browser den Fullscreen-Exit verarbeitet, dann sofort wieder rein
                    setTimeout(enterFullscreen, 50);
                }
            }
        }, true);

        // Falls Fullscreen durch ESC oder System verlassen wird
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement && !exitAllowed) {
                // Aggressives Wiederherstellen
                enterFullscreen();
                setTimeout(enterFullscreen, 150);
            }
        });

        // --- HAUPTUHR (SMOOTH) ---
        (function() {
            const canvas = document.getElementById('analogClock');
            const ctx = canvas.getContext('2d');
            const digitalTime = document.getElementById('digitalTime');

            function draw() {
                const now = new Date();
                const ms = now.getMilliseconds();
                const s = now.getSeconds() + ms / 1000;
                const m = now.getMinutes() + s / 60;
                const h = (now.getHours() % 12) + m / 60;

                digitalTime.textContent = 
                    String(now.getHours()).padStart(2, '0') + ':' +
                    String(now.getMinutes()).padStart(2, '0') + ':' +
                    String(now.getSeconds()).padStart(2, '0');

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Zifferblatt
                ctx.beginPath(); ctx.arc(200, 200, 190, 0, 2 * Math.PI);
                ctx.strokeStyle = 'rgba(255,255,255,0.8)'; ctx.lineWidth = 3; ctx.stroke();

                // Zahlen
                ctx.fillStyle = 'rgba(255,255,255,0.8)'; ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                for (let i = 1; i <= 12; i++) {
                    const ang = (i - 3) * (Math.PI / 6);
                    ctx.fillText(i, 200 + 160 * Math.cos(ang), 200 + 160 * Math.sin(ang));
                }

                // Zeiger zeichnen
                drawHand(ctx, h * (Math.PI / 6) - Math.PI / 2, 80, 8, 'rgba(255,255,255,0.9)');
                drawHand(ctx, m * (Math.PI / 30) - Math.PI / 2, 120, 5, 'rgba(255,255,255,0.8)');
                drawHand(ctx, s * (Math.PI / 30) - Math.PI / 2, 130, 2, 'rgba(220,20,60,0.9)');

                // Punkt
                ctx.beginPath(); ctx.arc(200, 200, 8, 0, 2 * Math.PI);
                ctx.fillStyle = 'white'; ctx.fill();
            }

            function drawHand(ctx, angle, length, width, color) {
                ctx.beginPath(); ctx.strokeStyle = color; ctx.lineWidth = width;
                ctx.moveTo(200, 200);
                ctx.lineTo(200 + length * Math.cos(angle), 200 + length * Math.sin(angle));
                ctx.stroke();
            }

            setInterval(draw, 16); // 60 FPS
        })();

        // --- OVERLAYS & SCHNEE ---
        (function(){
            // Z-Overlay (Analog) & Q-Overlay (Digital)
            const aOverlay = document.createElement('div'); aOverlay.className = 'clockOverlay';
            aOverlay.innerHTML = `<div class="clockContainer"><canvas class="analogCanvas" id="aCanvasO" width="400" height="400"></canvas></div>`;
            document.body.appendChild(aOverlay);

            const qOverlay = document.createElement('div'); qOverlay.className = 'clockOverlay';
            qOverlay.innerHTML = `<div class="clockContainer"><div id="dOnlyEl" class="digitalOnly">00:00:00</div></div>`;
            document.body.appendChild(qOverlay);

            let aT = null, qT = null;
            const aCtxO = document.getElementById('aCanvasO').getContext('2d');

            document.addEventListener('keydown', (e) => {
                if(isTyping()) return;
                const k = e.key.toLowerCase();
                if(k === 'z'){
                    if(aT) { clearInterval(aT); aT=null; aOverlay.classList.remove('visible'); }
                    else { aOverlay.classList.add('visible'); aT=setInterval(() => {
                        const n = new Date(); const s = n.getSeconds() + n.getMilliseconds()/1000;
                        const m = n.getMinutes() + s/60; const h = (n.getHours()%12) + m/60;
                        aCtxO.clearRect(0,0,400,400);
                        aCtxO.strokeStyle='white'; aCtxO.lineWidth=2; aCtxO.beginPath(); aCtxO.arc(200,200,190,0,7); aCtxO.stroke();
                        drawHandOverlay(aCtxO, h*Math.PI/6 - 1.57, 100, 6);
                        drawHandOverlay(aCtxO, m*Math.PI/30 - 1.57, 140, 4);
                        aCtxO.strokeStyle='#ff6b6b'; drawHandOverlay(aCtxO, s*Math.PI/30 - 1.57, 160, 2);
                    }, 16); }
                }
                if(k === 'q'){
                    if(qT) { clearInterval(qT); qT=null; qOverlay.classList.remove('visible'); }
                    else { qOverlay.classList.add('visible'); qT=setInterval(() => {
                        const n = new Date(); document.getElementById('dOnlyEl').textContent = n.toLocaleTimeString();
                    }, 100); }
                }
                // Schnee (F)
                if(k === 'f') toggleSnow();
            });

            function drawHandOverlay(ctx, ang, len, wid) {
                ctx.lineWidth=wid; ctx.beginPath(); ctx.moveTo(200,200);
                ctx.lineTo(200+Math.cos(ang)*len, 200+Math.sin(ang)*len); ctx.stroke();
            }

            let snowing = false, sInt = null;
            function toggleSnow() {
                snowing = !snowing;
                if(snowing) sInt = setInterval(() => {
                    const s = document.createElement('div'); s.className = 'snowflake'; s.textContent = '❄';
                    s.style.left = Math.random()*100+'%'; s.style.top = '-30px';
                    const d = Math.random()*5+8; s.style.animation = `fall ${d}s linear`;
                    document.body.appendChild(s); setTimeout(() => s.remove(), d*1000);
                }, 40);
                else clearInterval(sInt);
            }
        })();
    </script>
</body>
</html>